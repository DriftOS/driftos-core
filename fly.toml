app = 'driftos-core'
primary_region = 'lhr'

[build]

[env]
  NODE_ENV = 'production'
  PORT = '3000'
  HOST = '::'
  LOG_LEVEL = 'info'
  
  # API
  API_PREFIX = '/api'
  API_VERSION = 'v1'

  # Rate Limiting - REMOVED: All rate limiting is handled by the gateway

  # CORS - allow demo frontend
  CORS_ORIGIN = 'https://driftos-demo.fly.dev,https://playground.driftos.dev'
  CORS_CREDENTIALS = 'true'
  
  # Monitoring
  METRICS_ENABLED = 'true'
  METRICS_PATH = '/metrics'
  
  # Swagger
  SWAGGER_ENABLED = 'true'
  SWAGGER_PATH = '/documentation'
  
  # LLM
  LLM_PROVIDER = 'groq'
  LLM_MODEL = 'llama-3.1-8b-instant'
  LLM_TIMEOUT = '5000'
  
  # Drift
  DRIFT_MAX_BRANCHES_CONTEXT = '10'
  
  # Embeddings (local)
  EMBEDDING_MODEL = 'Xenova/all-MiniLM-L6-v2'

# Internal-only via Flycast (no public IPs)
[http_service]
  internal_port = 3000
  force_https = false
  auto_stop_machines = 'off'
  auto_start_machines = true
  min_machines_running = 1

[[http_service.checks]]
  grace_period = '30s'
  interval = '30s'
  method = 'GET'
  timeout = '10s'
  path = '/api/v1/health'

[[vm]]
  memory = '1gb'
  cpu_kind = 'shared'
  cpus = 1
